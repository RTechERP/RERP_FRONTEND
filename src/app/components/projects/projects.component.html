<div class="layout-wrapper d-flex" style="height: 100%">
  <div
    class="offcanvas offcanvas-left custom-offcanvas border border-1"
    tabindex="-1"
    id="searchOffcanvas"
    data-bs-backdrop="false"
  >
    <div class="offcanvas-header pt-0 mt-2 pb-0 mb-2">
      <h5 class="offcanvas-title fs-12">Tìm kiếm</h5>
      <button
        type="button"
        class="btn-close text-reset fs-12"
        data-bs-dismiss="offcanvas"
        aria-label="Close"
      ></button>
    </div>
    <div class="offcanvas-body pt-0 pb-0">
      <div class="row h-auto">
        <div class="col-12">
          <div class="form-group">
            <label class="fs-12">Từ ngày</label>
            <input
              type="date"
              name="date_start"
              [(ngModel)]="dateS"
              class="form-control form-control-sm fs-12"
              required=""
            />
          </div>
        </div>
        <div class="col-12 mt-2">
          <div class="form-group">
            <label class="fs-12">Đến ngày</label>
            <input
              type="date"
              name="date_start"
              [(ngModel)]="dateE"
              class="form-control form-control-sm fs-12"
              required=""
            />
          </div>
        </div>
        <div class="col-12 mt-2">
          <div class="form-group">
            <label for="" class="fs-12">Sale</label>
            <ng-select
              [items]="users"
              bindValue="ID"
              bindLabel="FullName"
              [(ngModel)]="selectedUser"
              [searchable]="true"
              placeholder="Chọn sale..."
              [clearable]="true"
              [virtualScroll]="true"
              class="form-control form-control-sm p-0 border border-0 fs-12"
            >
              <!-- Template hiển thị các lựa chọn trong dropdown -->
              <ng-template ng-option-tmp let-item="item">
                <div class="row text-dark w-100 fs-12">
                  <div class="col-3 ms-1 fs-12">
                    <span class="fs-12"
                      >{{ item.Code }} - {{ item.FullName }}</span
                    >
                  </div>
                </div>
              </ng-template>

              <!-- Template hiển thị sau khi chọn -->
              <ng-template ng-label-tmp let-item="item">
                <span class="fs-12">{{ item.FullName }}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
        <div class="col-12 mt-2">
          <div class="form-group">
            <label for="" class="fs-12">PM</label>
            <ng-select
              [items]="pms"
              bindValue="EmployeeID"
              bindLabel="FullName"
              [(ngModel)]="selectedPm"
              [searchable]="true"
              placeholder="Chọn pm..."
              [clearable]="true"
              [virtualScroll]="true"
              class="form-control form-control-sm p-0 border border-0 fs-12"
            >
              <!-- Template hiển thị các lựa chọn trong dropdown -->
              <ng-template ng-option-tmp let-item="item">
                <div class="row text-dark w-100 fs-12">
                  <div class="col-3 ms-1">
                    <span class="fs-12"
                      >{{ item.Code }} - {{ item.FullName }}</span
                    >
                  </div>
                </div>
              </ng-template>

              <!-- Template hiển thị sau khi chọn -->
              <ng-template ng-label-tmp let-item="item">
                <span class="fs-12">{{ item.FullName }}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
        <div class="col-12 mt-2">
          <div class="form-group">
            <label for="" class="fs-12">Kỹ thuật</label>
            <ng-select
              [items]="users"
              bindValue="ID"
              bindLabel="FullName"
              [(ngModel)]="selectedTechnical"
              [searchable]="true"
              placeholder="Chọn kỹ thuật thực hiện..."
              [clearable]="true"
              [virtualScroll]="true"
              class="form-control form-control-sm p-0 border border-0 fs-12"
            >
              <!-- Template hiển thị các lựa chọn trong dropdown -->
              <ng-template ng-option-tmp let-item="item">
                <div class="row text-dark w-100 fs-12">
                  <span class="fs-12"
                    >{{ item.Code }} - {{ item.FullName }}</span
                  >
                  <div class="col-3 ms-1"></div>
                </div>
              </ng-template>

              <!-- Template hiển thị sau khi chọn -->
              <ng-template ng-label-tmp let-item="item">
                <span class="fs-12">{{ item.FullName }}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
        <div class="col-12 mt-2">
          <div class="form-group">
            <label for="" class="fs-12">Lĩnh vực dự án</label>
            <ng-select
              [items]="businessFields"
              bindValue="ID"
              bindLabel="Name"
              [(ngModel)]="selectedBusinessField"
              [searchable]="true"
              placeholder="Chọn lĩnh vực dự án..."
              [clearable]="true"
              [virtualScroll]="true"
              class="form-control form-control-sm p-0 border border-0 fs-12"
            >
              <!-- Template hiển thị các lựa chọn trong dropdown -->
              <ng-template ng-option-tmp let-item="item">
                <div class="row text-dark w-100 fs-12">
                  <div class="col-3 ms-1">
                    <span class="fs-12">{{ item.Code }} - {{ item.Name }}</span>
                  </div>
                </div>
              </ng-template>

              <!-- Template hiển thị sau khi chọn -->
              <ng-template ng-label-tmp let-item="item">
                <span class="fs-12">{{ item.Name }}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
        <div class="col-12 mt-2">
          <div class="form-group">
            <label for="" class="fs-12">Khách hàng</label>
            <ng-select
              [items]="customers"
              bindValue="ID"
              bindLabel="CustomerName"
              [(ngModel)]="selectedCustomer"
              [searchable]="true"
              placeholder="Chọn khách hàng..."
              [clearable]="true"
              [virtualScroll]="true"
              class="form-control form-control-sm p-0 border border-0 fs-12"
            >
              <!-- Template hiển thị các lựa chọn trong dropdown -->
              <ng-template ng-option-tmp let-item="item">
                <div class="row text-dark w-100 fs-12">
                  <div class="col-3 ms-1">
                    <span class="fs-12"
                      >{{ item.CustomerCode }} - {{ item.CustomerName }}</span
                    >
                  </div>
                </div>
              </ng-template>

              <!-- Template hiển thị sau khi chọn -->
              <ng-template ng-label-tmp let-item="item">
                <span class="fs-12">{{ item.CustomerCode }}</span>
              </ng-template>
            </ng-select>
          </div>
        </div>
        <div class="col-12 mt-2">
          <div class="form-group">
            <label for="" class="fs-12">Kiểu dự án</label>
            <ng-select
              [items]="projectTypes"
              bindLabel="ProjectTypeName"
              bindValue="ID"
              [(ngModel)]="selectedProjectTypeIds"
              [multiple]="true"
              placeholder="Kiểu dự án..."
              class="form-control form-control-sm p-0 border border-0 fs-12"
            >
              <!-- Template hiển thị các lựa chọn trong dropdown -->
              <ng-template ng-option-tmp let-item="item">
                <div class="row text-dark w-100 fs-12">
                  <div class="col-3 ms-1">
                    <span class="fs-12">{{ item.ProjectTypeName }}</span>
                  </div>
                </div>
              </ng-template>

              <!-- Template hiển thị sau khi chọn -->
              <ng-template ng-label-tmp let-item="item" let-clear="clear">
                <span class="badge bg-secondary fs-12 p-1">
                  {{ item.ProjectTypeName }}
                  <span class="fs-12" (click)="clear(item)">✕</span>
                </span>
              </ng-template>
            </ng-select>
          </div>
          <div class="col-12 mt-2">
            <div class="form-group">
              <label for="" class="fs-12">Trạng thái</label>
              <ng-select
                [items]="projecStatuses"
                bindLabel="StatusName"
                bindValue="ID"
                [(ngModel)]="selectedProjecStatusIds"
                [multiple]="true"
                placeholder="Trạng thái..."
                class="form-control form-control-sm p-0 border border-0 fs-12"
              >
                <!-- Template hiển thị các lựa chọn trong dropdown -->
                <ng-template ng-option-tmp let-item="item">
                  <div class="row text-dark w-100 fs-12">
                    <div class="col-3 ms-1">
                      <span class="fs-12">{{ item.StatusName }}</span>
                    </div>
                  </div>
                </ng-template>

                <!-- Template hiển thị sau khi chọn -->
                <ng-template ng-label-tmp let-item="item" let-clear="clear">
                  <span class="bg-secondary fs-12 badge p-1">
                    {{ item.StatusName }}
                    <span class="fs-12" (click)="clear(item)">✕</span>
                  </span>
                </ng-template>
              </ng-select>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="form-group">
              <label for="" class="fs-12">Từ khóa</label>
              <input
                [(ngModel)]="searchText"
                class="form-control form-control-sm fs-12"
                type="text"
                name=""
                id=""
                placeholder="Nhập từ khóa..."
              />
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="form-group">
              <button
                class="btn btn-secondary col-12 p-0 ps-2 pe-2 fs-12"
                (click)="getProjects()"
              >
                Áp dụng
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid project-container" id="projectParent">
    <div class="row">
      <div class="col-12 p-0">
        <div class="card">
          <div class="card-header p-0">
            <div class="d-flex justify-content-start">
              <button
                type="button"
                class="btn btn-outline-secondary p-0 ps-2 pe-2"
                title="Tìm kiếm"
                data-bs-toggle="offcanvas"
                data-bs-target="#searchOffcanvas"
              >
                <i class="fas fa-search"></i> Tìm kiếm
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary p-0 ps-2 pe-2"
                title="Thêm mới"
                (click)="openAddProjectModal()"
              >
                <i class="fas fa-plus"></i> Thêm
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary p-0 ps-2 pe-2"
                title="Sửa"
                (click)="openEditProjectModal()"
              >
                <i class="fas fa-pen"></i> Sửa
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary p-0 ps-2 pe-2"
                title="Xóa"
                (click)="deletedProjects()"
              >
                <i class="fas fa-trash"></i> Xóa
              </button>
              <button
                type="button"
                class="btn btn-outline-secondary p-0 ps-2 pe-2"
                title="Xuất Excel"
                (click)="exportExcel()"
              >
                <i class="fas fa-file-excel"></i> Xuất excel
              </button>
            </div>
          </div>
          <div class="card-body p-0">
            <div class="row">
              <div class="col-12 col-sm-12 h-auto">
                <div class="border-top">
                  <div id="tb_projects"></div>
                </div>
              </div>
              <div class="col-3 pe-0 col-sm-3">
                <div class="border">
                  <div id="tb_projectTypeLinks"></div>
                </div>
              </div>
              <div class="col-9 ps-0 col-sm-9">
                <div class="border">
                  <div id="tb_projectitems"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
